package com.scalaProgram4.chapter07

object testUnit {
  def main(args: Array[String]): Unit = {
    def greet() = {println("hi")}

    val whatIAm = greet()
    "SELECT T.USER_ID_A,\n             T.SERIAL_NUMBER_A,\n             T.USER_ID_B,\n             T.SERIAL_NUMBER_B,\n             T.RELATION_TYPE_CBSS,\n             T.START_DATE,\n             T.END_DATE,\n             T.ITEM_ID,\n             T.IS_VALID,\n             T.RELATION_TYPE\n      FROM (SELECT T.USER_ID_A,\n                   T.SERIAL_NUMBER_A,\n                   T.USER_ID_B,\n                   T.SERIAL_NUMBER_B,\n                   T.RELATION_TYPE_CBSS,\n                   T.START_DATE,\n                   T.END_DATE,\n                   T.ITEM_ID,\n                   T.IS_VALID,\n                   T.RELATION_TYPE,\n                   ROW_NUMBER() OVER(PARTITION BY T.USER_ID_B, T.RELATION_TYPE_T1 ORDER BY T.IS_VALID DESC, T.START_DATE DESC, T.END_DATE DESC, T.RELATION_TYPE, T.USER_ID_A) RN\n            FROM (SELECT T1.USER_ID_A,\n                         T1.SERIAL_NUMBER_A,\n                         T1.USER_ID_B,\n                         T1.SERIAL_NUMBER_B,\n                         T1.RELATION_TYPE RELATION_TYPE_CBSS,\n                         T1.START_DATE,\n                         T1.END_DATE,\n                         T1.ITEM_ID,\n                         T1.IS_VALID,\n                         T2.RELATION_TYPE,\n                         CASE\n                             WHEN T2.RELATION_TYPE IN ('81', '82', '83') THEN\n                                 '999'\n                             ELSE\n                                 T2.RELATION_TYPE\n                             END RELATION_TYPE_T1\n                  FROM (SELECT T.USER_ID_A,\n                               T.SERIAL_NUMBER_A,\n                               T.USER_ID_B,\n                               T.SERIAL_NUMBER_B,\n                               T.RELATION_TYPE,\n                               T.START_DATE,\n                               T.END_DATE,\n                               T.ITEM_ID,\n                               CASE\n                                   WHEN SUBSTR(START_DATE, 1, 8) <=\n                                        1 AND\n                                        SUBSTR(END_DATE, 1, 8) >=\n                                        1 THEN\n                                       '1'\n                                   ELSE\n                                       '0'\n                                   END IS_VALID\n                        FROM (SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_PRD_CB_RELATION_UU_RT\t\t\t-- 第一张表\n                              WHERE ACCT_DATE = 20211003\n                                 OR BATCH_ID = 1\n                              UNION ALL\n                              SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_D_PRD_CB_RELATION_UU_LX\t\t-- 第二张表\n                              WHERE MONTH_ID = 1\n                                AND DAY_ID = 1) T) T1\n                           JOIN DWA_MAP_CBSS_RELATION_TYPE T2\t\t\t\t\t-- 2.1张表\n                                ON T1.RELATION_TYPE = T2.RELATION_TYPE_CBSS) T) T\n      WHERE RN = 1"

    // 前三张表，带case when 和 字符
    "SELECT T.USER_ID_A,\n             T.SERIAL_NUMBER_A,\n             T.USER_ID_B,\n             T.SERIAL_NUMBER_B,\n             T.RELATION_TYPE_CBSS,\n             T.START_DATE,\n             T.END_DATE,\n             T.ITEM_ID,\n             T.IS_VALID,\n             T.RELATION_TYPE\n      FROM (SELECT T.USER_ID_A,\n                   T.SERIAL_NUMBER_A,\n                   T.USER_ID_B,\n                   T.SERIAL_NUMBER_B,\n                   T.RELATION_TYPE_CBSS,\n                   T.START_DATE,\n                   T.END_DATE,\n                   T.ITEM_ID,\n                   T.IS_VALID,\n                   T.RELATION_TYPE,\n                   ROW_NUMBER() OVER(PARTITION BY T.USER_ID_B, T.RELATION_TYPE_T1 ORDER BY T.IS_VALID DESC, T.START_DATE DESC, T.END_DATE DESC, T.RELATION_TYPE, T.USER_ID_A) RN\n            FROM (SELECT T1.USER_ID_A,\n                         T1.SERIAL_NUMBER_A,\n                         T1.USER_ID_B,\n                         T1.SERIAL_NUMBER_B,\n                         T1.RELATION_TYPE RELATION_TYPE_CBSS,\n                         T1.START_DATE,\n                         T1.END_DATE,\n                         T1.ITEM_ID,\n                         T1.IS_VALID,\n                         T2.RELATION_TYPE,\n                         CASE\n                             WHEN T2.RELATION_TYPE IN ('81', '82', '83') THEN\n                                 '999'\n                             ELSE\n                                 T2.RELATION_TYPE\n                             END RELATION_TYPE_T1\n                  FROM (SELECT T.USER_ID_A,\n                               T.SERIAL_NUMBER_A,\n                               T.USER_ID_B,\n                               T.SERIAL_NUMBER_B,\n                               T.RELATION_TYPE,\n                               T.START_DATE,\n                               T.END_DATE,\n                               T.ITEM_ID,\n                               CASE\n                                   WHEN SUBSTR(START_DATE, 1, 8) <=\n                                        1 AND\n                                        SUBSTR(END_DATE, 1, 8) >=\n                                        1 THEN\n                                       '1'\n                                   ELSE\n                                       '0'\n                                   END IS_VALID\n                        FROM (SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_PRD_CB_RELATION_UU_RT\t\t\t-- 第一张表\n                              WHERE ACCT_DATE = 20211003\n                                 OR BATCH_ID = 1\n                              UNION ALL\n                              SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_D_PRD_CB_RELATION_UU_LX\t\t-- 第二张表\n                              WHERE MONTH_ID = 1\n                                AND DAY_ID = 1) T) T1\n                           JOIN DWA_MAP_CBSS_RELATION_TYPE T2\t\t\t\t\t-- 2.1张表\n                                ON T1.RELATION_TYPE = T2.RELATION_TYPE_CBSS) T) T\n      WHERE RN = 1"

    // 去掉了所有substr
    "SELECT USER_ID,\n                                 CASE\n                                     WHEN T.START_DATE <= 1 AND\n                                          T.END_DATE >= 1 THEN\n                                         '1'\n                                     ELSE\n                                         '0'\n                                     END IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T\t\t-- 第6张表\n                          WHERE PRODUCT_MODE IN ('00')\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, '-') <=\n                                          1 AND\n                                          REPLACE(END_DATE, '-') >=\n                                          1 THEN\n                                         '1'\n                                     ELSE\n                                         '0'\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT\t\t\t\t\t-- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, '-') <=\n                                          1 AND\n                                          REPLACE(END_DATE, '-') >=\n                                          1 THEN\n                                         '1'\n                                     ELSE\n                                         '0'\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW\t\t\t-- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)"

    // 去掉了所有的字符
    "SELECT USER_ID,\n                                 CASE\n                                     WHEN T.START_DATE <= 1 AND\n                                          T.END_DATE >= 1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T\t\t-- 第6张表\n                          WHERE PRODUCT_MODE IN (0)\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT\t\t\t\t\t-- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW\t\t\t-- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)"

    // 最后一个子查询
    "SELECT MAX(IS_VALID) IS_VALID, USER_ID\n                    FROM (SELECT USER_ID,\n                                 CASE\n                                     WHEN T.START_DATE <= 1 AND\n                                          T.END_DATE >= 1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T\t\t-- 第6张表\n                          WHERE PRODUCT_MODE IN (0)\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT\t\t\t\t\t-- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW\t\t\t-- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)) T\n                    GROUP BY USER_ID"

    "---1\nSELECT C.PROV_ID,\n       C.AREA_ID,\n       C.AREA_ID_CBSS,\n       C.CITY_ID,\n       C.CITY_ID_CBSS,\n       C.SERVICE_TYPE,\n       A.USER_ID_B USER_ID,\n       A.USER_ID_A COMP_ID,\n       C.DEVICE_NUMBER,\n       '' MAIN_DEVICE_NUMBER,\n       A.RELATION_TYPE COMP_TYPE,\n       A.START_DATE,\n       A.END_DATE,\n       CASE\n           WHEN A.RELATION_TYPE IN ('81', '82', '83') AND A.IS_VALID = '1' AND\n                COALESCE(E.IS_VALID, '0') = '1' THEN\n               '1'\n           WHEN A.RELATION_TYPE NOT IN ('81', '82', '83') AND\n                A.IS_VALID = '1' THEN\n               '1'\n           ELSE\n               '0'\n           END IF_USER_VALID,\n       CASE\n           WHEN A.RELATION_TYPE IN ('81', '82', '83') AND A.IS_VALID = '1' AND\n                COALESCE(E.IS_VALID, '0') = '1' THEN\n               '1'\n           WHEN A.RELATION_TYPE NOT IN ('81', '82', '83') AND\n                A.IS_VALID = '1' THEN\n               '1'\n           ELSE\n               '0'\n           END IF_COMP_VALID,\n       C.INNET_DATE,\n       '' ACCEPT_CHANNEL_COMP,\n       '' ACCEPT_MAN_COMP,\n       '' ACCEPT_CHANNEL_USER,\n       '' ACCEPT_MAN_USER,\n       C.IS_STAT,\n       C.IS_INNET,\n       C.IS_THIS_DEV,\n       '' NEW_FLAG_COMP,\n       '' NEW_FLAG_USER,\n       '' ACCEPT_DATE_COMP,\n       '' ACCEPT_DATE_USER,\n       C.CHANNEL_ID,\n       1,\n       1\nFROM (SELECT T.USER_ID_A,\n             T.SERIAL_NUMBER_A,\n             T.USER_ID_B,\n             T.SERIAL_NUMBER_B,\n             T.RELATION_TYPE_CBSS,\n             T.START_DATE,\n             T.END_DATE,\n             T.ITEM_ID,\n             T.IS_VALID,\n             T.RELATION_TYPE\n      FROM (SELECT T.USER_ID_A,\n                   T.SERIAL_NUMBER_A,\n                   T.USER_ID_B,\n                   T.SERIAL_NUMBER_B,\n                   T.RELATION_TYPE_CBSS,\n                   T.START_DATE,\n                   T.END_DATE,\n                   T.ITEM_ID,\n                   T.IS_VALID,\n                   T.RELATION_TYPE,\n                   ROW_NUMBER() OVER(PARTITION BY T.USER_ID_B, T.RELATION_TYPE_T1 ORDER BY T.IS_VALID DESC, T.START_DATE DESC, T.END_DATE DESC, T.RELATION_TYPE, T.USER_ID_A) RN\n            FROM (SELECT T1.USER_ID_A,\n                         T1.SERIAL_NUMBER_A,\n                         T1.USER_ID_B,\n                         T1.SERIAL_NUMBER_B,\n                         T1.RELATION_TYPE RELATION_TYPE_CBSS,\n                         T1.START_DATE,\n                         T1.END_DATE,\n                         T1.ITEM_ID,\n                         T1.IS_VALID,\n                         T2.RELATION_TYPE,\n                         CASE\n                             WHEN T2.RELATION_TYPE IN ('81', '82', '83') THEN\n                                 '999'\n                             ELSE\n                                 T2.RELATION_TYPE\n                             END RELATION_TYPE_T1\n                  FROM (SELECT T.USER_ID_A,\n                               T.SERIAL_NUMBER_A,\n                               T.USER_ID_B,\n                               T.SERIAL_NUMBER_B,\n                               T.RELATION_TYPE,\n                               T.START_DATE,\n                               T.END_DATE,\n                               T.ITEM_ID,\n                               CASE\n                                   WHEN SUBSTR(START_DATE, 1, 8) <=\n                                        1 AND\n                                        SUBSTR(END_DATE, 1, 8) >=\n                                        1 THEN\n                                       '1'\n                                   ELSE\n                                       '0'\n                                   END IS_VALID\n                        FROM (SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_PRD_CB_RELATION_UU_RT\t\t\t-- 第一张表\n                              WHERE ACCT_DATE = 20211003\n                                 OR BATCH_ID = 1\n                              UNION ALL\n                              SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_D_PRD_CB_RELATION_UU_LX\t\t-- 第二张表\n                              WHERE MONTH_ID = 1\n                                AND DAY_ID = 1) T) T1\n                           JOIN DWA_MAP_CBSS_RELATION_TYPE T2\t\t\t\t\t-- 2.1张表\n                                ON T1.RELATION_TYPE = T2.RELATION_TYPE_CBSS) T) T\n      WHERE RN = 1) A\n         JOIN (SELECT *\n               FROM (SELECT T.*,\n                            ROW_NUMBER() OVER(PARTITION BY USER_ID ORDER BY NVL(IS_INNET,'0') DESC) RN\n                     FROM (SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  '' IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  '' AREA_ID_CBSS,\n                                  '' CITY_ID,\n                                  '' CITY_ID_CBSS,\n                                  T.CHANNEL_TYPE CHANNEL_ID\n                           FROM DWA_V_RT_CUS_CB_USER_INFO T\t\t\t\t-- 第4张表\n                           WHERE ACCT_DATE = 1\n                              OR (ACCT_DATE = 1 AND BATCH_ID = 1)\n                           UNION ALL\n                           SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  T.IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  T.AREA_ID_CBSS,\n                                  T.CITY_ID,\n                                  T.CITY_ID_CBSS,\n                                  T.CHANNEL_ID\n                           FROM DWA_V_D_CUS_CB_USER_INFO_LX T\t\t\t-- 第5张表\n                           WHERE MONTH_ID =\n                                 1\n                             AND DAY_ID =\n                                 1) T)\n               WHERE RN = 1) C\n              ON A.USER_ID_B = C.USER_ID\n         LEFT JOIN (SELECT MAX(IS_VALID) IS_VALID, USER_ID\n                    FROM (SELECT USER_ID,\n                                 CASE\n                                     WHEN T.START_DATE <= 1 AND\n                                          T.END_DATE >= 1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T\t\t-- 第6张表\n                          WHERE PRODUCT_MODE IN (0)\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT\t\t\t\t\t-- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW\t\t\t-- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)) T\n                    GROUP BY USER_ID) E\n                   ON A.USER_ID_A = E.USER_ID"

    "---1\nSELECT C.PROV_ID,\n       C.AREA_ID,\n       C.AREA_ID_CBSS,\n       C.CITY_ID,\n       C.CITY_ID_CBSS,\n       C.SERVICE_TYPE,\n       A.USER_ID_B USER_ID,\n       A.USER_ID_A COMP_ID,\n       C.DEVICE_NUMBER,\n       1 MAIN_DEVICE_NUMBER,\n       A.RELATION_TYPE COMP_TYPE,\n       A.START_DATE,\n       A.END_DATE,\n       CASE\n           WHEN A.RELATION_TYPE IN (81, 11, 1) AND A.IS_VALID = 1 AND\n                COALESCE(E.IS_VALID, '0') = '1' THEN\n               1\n           WHEN A.RELATION_TYPE NOT IN (1, 11, 111) AND\n                A.IS_VALID = 1 THEN\n               1\n           ELSE\n               0\n           END IF_USER_VALID,\n       CASE\n           WHEN A.RELATION_TYPE IN (1, 111, 11) AND A.IS_VALID = 1 AND\n                COALESCE(E.IS_VALID, '0') = '1' THEN\n               1\n           WHEN A.RELATION_TYPE NOT IN (111, 111, 1111) AND\n                A.IS_VALID = 1 THEN\n               1\n           ELSE\n               0\n           END IF_COMP_VALID,\n       C.INNET_DATE,\n       1 ACCEPT_CHANNEL_COMP,\n       1 ACCEPT_MAN_COMP,\n       1 ACCEPT_CHANNEL_USER,\n       1 ACCEPT_MAN_USER,\n       C.IS_STAT,\n       C.IS_INNET,\n       C.IS_THIS_DEV,\n       1 NEW_FLAG_COMP,\n       1 NEW_FLAG_USER,\n       1 ACCEPT_DATE_COMP,\n       1 ACCEPT_DATE_USER,\n       C.CHANNEL_ID,\n       1,\n       1\nFROM (SELECT T.USER_ID_A,\n             T.SERIAL_NUMBER_A,\n             T.USER_ID_B,\n             T.SERIAL_NUMBER_B,\n             T.RELATION_TYPE_CBSS,\n             T.START_DATE,\n             T.END_DATE,\n             T.ITEM_ID,\n             T.IS_VALID,\n             T.RELATION_TYPE\n      FROM (SELECT T.USER_ID_A,\n                   T.SERIAL_NUMBER_A,\n                   T.USER_ID_B,\n                   T.SERIAL_NUMBER_B,\n                   T.RELATION_TYPE_CBSS,\n                   T.START_DATE,\n                   T.END_DATE,\n                   T.ITEM_ID,\n                   T.IS_VALID,\n                   T.RELATION_TYPE,\n                   ROW_NUMBER() OVER(PARTITION BY T.USER_ID_B, T.RELATION_TYPE_T1 ORDER BY T.IS_VALID DESC, T.START_DATE DESC, T.END_DATE DESC, T.RELATION_TYPE, T.USER_ID_A) RN\n            FROM (SELECT T1.USER_ID_A,\n                         T1.SERIAL_NUMBER_A,\n                         T1.USER_ID_B,\n                         T1.SERIAL_NUMBER_B,\n                         T1.RELATION_TYPE RELATION_TYPE_CBSS,\n                         T1.START_DATE,\n                         T1.END_DATE,\n                         T1.ITEM_ID,\n                         T1.IS_VALID,\n                         T2.RELATION_TYPE,\n                         CASE\n                             WHEN T2.RELATION_TYPE IN ('81', '82', '83') THEN\n                                 '999'\n                             ELSE\n                                 T2.RELATION_TYPE\n                             END RELATION_TYPE_T1\n                  FROM (SELECT T.USER_ID_A,\n                               T.SERIAL_NUMBER_A,\n                               T.USER_ID_B,\n                               T.SERIAL_NUMBER_B,\n                               T.RELATION_TYPE,\n                               T.START_DATE,\n                               T.END_DATE,\n                               T.ITEM_ID,\n                               CASE\n                                   WHEN SUBSTR(START_DATE, 1, 8) <=\n                                        1 AND\n                                        SUBSTR(END_DATE, 1, 8) >=\n                                        1 THEN\n                                       '1'\n                                   ELSE\n                                       '0'\n                                   END IS_VALID\n                        FROM (SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_PRD_CB_RELATION_UU_RT\t\t\t-- 第一张表\n                              WHERE ACCT_DATE = 20211003\n                                 OR BATCH_ID = 1\n                              UNION ALL\n                              SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_D_PRD_CB_RELATION_UU_LX\t\t-- 第二张表\n                              WHERE MONTH_ID = 1\n                                AND DAY_ID = 1) T) T1\n                           JOIN DWA_MAP_CBSS_RELATION_TYPE T2\t\t\t\t\t-- 2.1张表\n                                ON T1.RELATION_TYPE = T2.RELATION_TYPE_CBSS) T) T\n      WHERE RN = 1) A\n         JOIN (SELECT *\n               FROM (SELECT T.*,\n                            ROW_NUMBER() OVER(PARTITION BY USER_ID ORDER BY NVL(IS_INNET,'0') DESC) RN\n                     FROM (SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  '' IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  '' AREA_ID_CBSS,\n                                  '' CITY_ID,\n                                  '' CITY_ID_CBSS,\n                                  T.CHANNEL_TYPE CHANNEL_ID\n                           FROM DWA_V_RT_CUS_CB_USER_INFO T\t\t\t\t-- 第4张表\n                           WHERE ACCT_DATE = 1\n                              OR (ACCT_DATE = 1 AND BATCH_ID = 1)\n                           UNION ALL\n                           SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  T.IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  T.AREA_ID_CBSS,\n                                  T.CITY_ID,\n                                  T.CITY_ID_CBSS,\n                                  T.CHANNEL_ID\n                           FROM DWA_V_D_CUS_CB_USER_INFO_LX T\t\t\t-- 第5张表\n                           WHERE MONTH_ID =\n                                 1\n                             AND DAY_ID =\n                                 1) T)\n               WHERE RN = 1) C\n              ON A.USER_ID_B = C.USER_ID\n         LEFT JOIN (SELECT MAX(IS_VALID) IS_VALID, USER_ID\n                    FROM (SELECT USER_ID,\n                                 CASE\n                                     WHEN T.START_DATE <= 1 AND\n                                          T.END_DATE >= 1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T\t\t-- 第6张表\n                          WHERE PRODUCT_MODE IN (0)\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT\t\t\t\t\t-- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW\t\t\t-- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)) T\n                    GROUP BY USER_ID) E\n                   ON A.USER_ID_A = E.USER_ID"

    // 完整sql去掉所有字符
    "---1\nSELECT C.PROV_ID,\n       C.AREA_ID,\n       C.AREA_ID_CBSS,\n       C.CITY_ID,\n       C.CITY_ID_CBSS,\n       C.SERVICE_TYPE,\n       A.USER_ID_B USER_ID,\n       A.USER_ID_A COMP_ID,\n       C.DEVICE_NUMBER,\n       1 MAIN_DEVICE_NUMBER,\n       A.RELATION_TYPE COMP_TYPE,\n       A.START_DATE,\n       A.END_DATE,\n       CASE\n           WHEN A.RELATION_TYPE IN (81, 11, 1) AND A.IS_VALID = 1 AND\n                COALESCE(E.IS_VALID, 0) = 1 THEN\n               1\n           WHEN A.RELATION_TYPE NOT IN (1, 11, 111) AND\n                A.IS_VALID = 1 THEN\n               1\n           ELSE\n               0\n           END IF_USER_VALID,\n       CASE\n           WHEN A.RELATION_TYPE IN (1, 111, 11) AND A.IS_VALID = 1 AND\n                COALESCE(E.IS_VALID, 0) = 1 THEN\n               1\n           WHEN A.RELATION_TYPE NOT IN (111, 111, 1111) AND\n                A.IS_VALID = 1 THEN\n               1\n           ELSE\n               0\n           END IF_COMP_VALID,\n       C.INNET_DATE,\n       1 ACCEPT_CHANNEL_COMP,\n       1 ACCEPT_MAN_COMP,\n       1 ACCEPT_CHANNEL_USER,\n       1 ACCEPT_MAN_USER,\n       C.IS_STAT,\n       C.IS_INNET,\n       C.IS_THIS_DEV,\n       1 NEW_FLAG_COMP,\n       1 NEW_FLAG_USER,\n       1 ACCEPT_DATE_COMP,\n       1 ACCEPT_DATE_USER,\n       C.CHANNEL_ID,\n       1,\n       1\nFROM (SELECT T.USER_ID_A,\n             T.SERIAL_NUMBER_A,\n             T.USER_ID_B,\n             T.SERIAL_NUMBER_B,\n             T.RELATION_TYPE_CBSS,\n             T.START_DATE,\n             T.END_DATE,\n             T.ITEM_ID,\n             T.IS_VALID,\n             T.RELATION_TYPE\n      FROM (SELECT T.USER_ID_A,\n                   T.SERIAL_NUMBER_A,\n                   T.USER_ID_B,\n                   T.SERIAL_NUMBER_B,\n                   T.RELATION_TYPE_CBSS,\n                   T.START_DATE,\n                   T.END_DATE,\n                   T.ITEM_ID,\n                   T.IS_VALID,\n                   T.RELATION_TYPE,\n                   ROW_NUMBER() OVER(PARTITION BY T.USER_ID_B, T.RELATION_TYPE_T1 ORDER BY T.IS_VALID DESC, T.START_DATE DESC, T.END_DATE DESC, T.RELATION_TYPE, T.USER_ID_A) RN\n            FROM (SELECT T1.USER_ID_A,\n                         T1.SERIAL_NUMBER_A,\n                         T1.USER_ID_B,\n                         T1.SERIAL_NUMBER_B,\n                         T1.RELATION_TYPE RELATION_TYPE_CBSS,\n                         T1.START_DATE,\n                         T1.END_DATE,\n                         T1.ITEM_ID,\n                         T1.IS_VALID,\n                         T2.RELATION_TYPE,\n                         CASE\n                             WHEN T2.RELATION_TYPE IN ('81', '82', '83') THEN\n                                 '999'\n                             ELSE\n                                 T2.RELATION_TYPE\n                             END RELATION_TYPE_T1\n                  FROM (SELECT T.USER_ID_A,\n                               T.SERIAL_NUMBER_A,\n                               T.USER_ID_B,\n                               T.SERIAL_NUMBER_B,\n                               T.RELATION_TYPE,\n                               T.START_DATE,\n                               T.END_DATE,\n                               T.ITEM_ID,\n                               CASE\n                                   WHEN SUBSTR(START_DATE, 1, 8) <=\n                                        1 AND\n                                        SUBSTR(END_DATE, 1, 8) >=\n                                        1 THEN\n                                       '1'\n                                   ELSE\n                                       '0'\n                                   END IS_VALID\n                        FROM (SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_PRD_CB_RELATION_UU_RT\t\t\t-- 第一张表\n                              WHERE ACCT_DATE = 20211003\n                                 OR BATCH_ID = 1\n                              UNION ALL\n                              SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_D_PRD_CB_RELATION_UU_LX\t\t-- 第二张表\n                              WHERE MONTH_ID = 1\n                                AND DAY_ID = 1) T) T1\n                           JOIN DWA_MAP_CBSS_RELATION_TYPE T2\t\t\t\t\t-- 2.1张表\n                                ON T1.RELATION_TYPE = T2.RELATION_TYPE_CBSS) T) T\n      WHERE RN = 1) A\n         JOIN (SELECT *\n               FROM (SELECT T.*,\n                            ROW_NUMBER() OVER(PARTITION BY USER_ID ORDER BY NVL(IS_INNET,'0') DESC) RN\n                     FROM (SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  '' IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  '' AREA_ID_CBSS,\n                                  '' CITY_ID,\n                                  '' CITY_ID_CBSS,\n                                  T.CHANNEL_TYPE CHANNEL_ID\n                           FROM DWA_V_RT_CUS_CB_USER_INFO T\t\t\t\t-- 第4张表\n                           WHERE ACCT_DATE = 1\n                              OR (ACCT_DATE = 1 AND BATCH_ID = 1)\n                           UNION ALL\n                           SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  T.IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  T.AREA_ID_CBSS,\n                                  T.CITY_ID,\n                                  T.CITY_ID_CBSS,\n                                  T.CHANNEL_ID\n                           FROM DWA_V_D_CUS_CB_USER_INFO_LX T\t\t\t-- 第5张表\n                           WHERE MONTH_ID =\n                                 1\n                             AND DAY_ID =\n                                 1) T)\n               WHERE RN = 1) C\n              ON A.USER_ID_B = C.USER_ID\n         LEFT JOIN (SELECT MAX(IS_VALID) IS_VALID, USER_ID\n                    FROM (SELECT USER_ID,\n                                 CASE\n                                     WHEN T.START_DATE <= 1 AND\n                                          T.END_DATE >= 1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T\t\t-- 第6张表\n                          WHERE PRODUCT_MODE IN (0)\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT\t\t\t\t\t-- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW\t\t\t-- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)) T\n                    GROUP BY USER_ID) E\n                   ON A.USER_ID_A = E.USER_ID"

    // 完整sql去掉coalesce
    "---1\nSELECT C.PROV_ID,\n       C.AREA_ID,\n       C.AREA_ID_CBSS,\n       C.CITY_ID,\n       C.CITY_ID_CBSS,\n       C.SERVICE_TYPE,\n       A.USER_ID_B USER_ID,\n       A.USER_ID_A COMP_ID,\n       C.DEVICE_NUMBER,\n       1 MAIN_DEVICE_NUMBER,\n       A.RELATION_TYPE COMP_TYPE,\n       A.START_DATE,\n       A.END_DATE,\n       CASE\n           WHEN A.RELATION_TYPE IN (81, 11, 1) AND A.IS_VALID = 1 THEN\n               1\n           WHEN A.RELATION_TYPE NOT IN (1, 11, 111) AND\n                A.IS_VALID = 1 THEN\n               1\n           ELSE\n               0\n           END IF_USER_VALID,\n       CASE\n           WHEN A.RELATION_TYPE IN (1, 111, 11) AND A.IS_VALID = 1  THEN\n               1\n           WHEN A.RELATION_TYPE NOT IN (111, 111, 1111) AND\n                A.IS_VALID = 1 THEN\n               1\n           ELSE\n               0\n           END IF_COMP_VALID,\n       C.INNET_DATE,\n       1 ACCEPT_CHANNEL_COMP,\n       1 ACCEPT_MAN_COMP,\n       1 ACCEPT_CHANNEL_USER,\n       1 ACCEPT_MAN_USER,\n       C.IS_STAT,\n       C.IS_INNET,\n       C.IS_THIS_DEV,\n       1 NEW_FLAG_COMP,\n       1 NEW_FLAG_USER,\n       1 ACCEPT_DATE_COMP,\n       1 ACCEPT_DATE_USER,\n       C.CHANNEL_ID,\n       1,\n       1\nFROM (SELECT T.USER_ID_A,\n             T.SERIAL_NUMBER_A,\n             T.USER_ID_B,\n             T.SERIAL_NUMBER_B,\n             T.RELATION_TYPE_CBSS,\n             T.START_DATE,\n             T.END_DATE,\n             T.ITEM_ID,\n             T.IS_VALID,\n             T.RELATION_TYPE\n      FROM (SELECT T.USER_ID_A,\n                   T.SERIAL_NUMBER_A,\n                   T.USER_ID_B,\n                   T.SERIAL_NUMBER_B,\n                   T.RELATION_TYPE_CBSS,\n                   T.START_DATE,\n                   T.END_DATE,\n                   T.ITEM_ID,\n                   T.IS_VALID,\n                   T.RELATION_TYPE,\n                   ROW_NUMBER() OVER(PARTITION BY T.USER_ID_B, T.RELATION_TYPE_T1 ORDER BY T.IS_VALID DESC, T.START_DATE DESC, T.END_DATE DESC, T.RELATION_TYPE, T.USER_ID_A) RN\n            FROM (SELECT T1.USER_ID_A,\n                         T1.SERIAL_NUMBER_A,\n                         T1.USER_ID_B,\n                         T1.SERIAL_NUMBER_B,\n                         T1.RELATION_TYPE RELATION_TYPE_CBSS,\n                         T1.START_DATE,\n                         T1.END_DATE,\n                         T1.ITEM_ID,\n                         T1.IS_VALID,\n                         T2.RELATION_TYPE,\n                         CASE\n                             WHEN T2.RELATION_TYPE IN ('81', '82', '83') THEN\n                                 '999'\n                             ELSE\n                                 T2.RELATION_TYPE\n                             END RELATION_TYPE_T1\n                  FROM (SELECT T.USER_ID_A,\n                               T.SERIAL_NUMBER_A,\n                               T.USER_ID_B,\n                               T.SERIAL_NUMBER_B,\n                               T.RELATION_TYPE,\n                               T.START_DATE,\n                               T.END_DATE,\n                               T.ITEM_ID,\n                               CASE\n                                   WHEN SUBSTR(START_DATE, 1, 8) <=\n                                        1 AND\n                                        SUBSTR(END_DATE, 1, 8) >=\n                                        1 THEN\n                                       '1'\n                                   ELSE\n                                       '0'\n                                   END IS_VALID\n                        FROM (SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_PRD_CB_RELATION_UU_RT\t\t\t-- 第一张表\n                              WHERE ACCT_DATE = 20211003\n                                 OR BATCH_ID = 1\n                              UNION ALL\n                              SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_D_PRD_CB_RELATION_UU_LX\t\t-- 第二张表\n                              WHERE MONTH_ID = 1\n                                AND DAY_ID = 1) T) T1\n                           JOIN DWA_MAP_CBSS_RELATION_TYPE T2\t\t\t\t\t-- 2.1张表\n                                ON T1.RELATION_TYPE = T2.RELATION_TYPE_CBSS) T) T\n      WHERE RN = 1) A\n         JOIN (SELECT *\n               FROM (SELECT T.*,\n                            ROW_NUMBER() OVER(PARTITION BY USER_ID ORDER BY NVL(IS_INNET,'0') DESC) RN\n                     FROM (SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  '' IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  '' AREA_ID_CBSS,\n                                  '' CITY_ID,\n                                  '' CITY_ID_CBSS,\n                                  T.CHANNEL_TYPE CHANNEL_ID\n                           FROM DWA_V_RT_CUS_CB_USER_INFO T\t\t\t\t-- 第4张表\n                           WHERE ACCT_DATE = 1\n                              OR (ACCT_DATE = 1 AND BATCH_ID = 1)\n                           UNION ALL\n                           SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  T.IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  T.AREA_ID_CBSS,\n                                  T.CITY_ID,\n                                  T.CITY_ID_CBSS,\n                                  T.CHANNEL_ID\n                           FROM DWA_V_D_CUS_CB_USER_INFO_LX T\t\t\t-- 第5张表\n                           WHERE MONTH_ID =\n                                 1\n                             AND DAY_ID =\n                                 1) T)\n               WHERE RN = 1) C\n              ON A.USER_ID_B = C.USER_ID\n         LEFT JOIN (SELECT MAX(IS_VALID) IS_VALID, USER_ID\n                    FROM (SELECT USER_ID,\n                                 CASE\n                                     WHEN T.START_DATE <= 1 AND\n                                          T.END_DATE >= 1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T\t\t-- 第6张表\n                          WHERE PRODUCT_MODE IN (0)\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT\t\t\t\t\t-- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW\t\t\t-- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)) T\n                    GROUP BY USER_ID) E\n                   ON A.USER_ID_A = E.USER_ID"

    // 完整sql去掉coalesce, 去所有字符
    "---1\nSELECT C.PROV_ID,\n       C.AREA_ID,\n       C.AREA_ID_CBSS,\n       C.CITY_ID,\n       C.CITY_ID_CBSS,\n       C.SERVICE_TYPE,\n       A.USER_ID_B USER_ID,\n       A.USER_ID_A COMP_ID,\n       C.DEVICE_NUMBER,\n       1 MAIN_DEVICE_NUMBER,\n       A.RELATION_TYPE COMP_TYPE,\n       A.START_DATE,\n       A.END_DATE,\n       CASE\n           WHEN A.RELATION_TYPE IN (81, 11, 1) AND A.IS_VALID = 1 THEN\n               1\n           WHEN A.RELATION_TYPE NOT IN (1, 11, 111) AND\n                A.IS_VALID = 1 THEN\n               1\n           ELSE\n               0\n           END IF_USER_VALID,\n       CASE\n           WHEN A.RELATION_TYPE IN (1, 111, 11) AND A.IS_VALID = 1  THEN\n               1\n           WHEN A.RELATION_TYPE NOT IN (111, 111, 1111) AND\n                A.IS_VALID = 1 THEN\n               1\n           ELSE\n               0\n           END IF_COMP_VALID,\n       C.INNET_DATE,\n       1 ACCEPT_CHANNEL_COMP,\n       1 ACCEPT_MAN_COMP,\n       1 ACCEPT_CHANNEL_USER,\n       1 ACCEPT_MAN_USER,\n       C.IS_STAT,\n       C.IS_INNET,\n       C.IS_THIS_DEV,\n       1 NEW_FLAG_COMP,\n       1 NEW_FLAG_USER,\n       1 ACCEPT_DATE_COMP,\n       1 ACCEPT_DATE_USER,\n       C.CHANNEL_ID,\n       1,\n       1\nFROM (SELECT T.USER_ID_A,\n             T.SERIAL_NUMBER_A,\n             T.USER_ID_B,\n             T.SERIAL_NUMBER_B,\n             T.RELATION_TYPE_CBSS,\n             T.START_DATE,\n             T.END_DATE,\n             T.ITEM_ID,\n             T.IS_VALID,\n             T.RELATION_TYPE\n      FROM (SELECT T.USER_ID_A,\n                   T.SERIAL_NUMBER_A,\n                   T.USER_ID_B,\n                   T.SERIAL_NUMBER_B,\n                   T.RELATION_TYPE_CBSS,\n                   T.START_DATE,\n                   T.END_DATE,\n                   T.ITEM_ID,\n                   T.IS_VALID,\n                   T.RELATION_TYPE,\n                   ROW_NUMBER() OVER(PARTITION BY T.USER_ID_B, T.RELATION_TYPE_T1 ORDER BY T.IS_VALID DESC, T.START_DATE DESC, T.END_DATE DESC, T.RELATION_TYPE, T.USER_ID_A) RN\n            FROM (SELECT T1.USER_ID_A,\n                         T1.SERIAL_NUMBER_A,\n                         T1.USER_ID_B,\n                         T1.SERIAL_NUMBER_B,\n                         T1.RELATION_TYPE RELATION_TYPE_CBSS,\n                         T1.START_DATE,\n                         T1.END_DATE,\n                         T1.ITEM_ID,\n                         T1.IS_VALID,\n                         T2.RELATION_TYPE,\n                         CASE\n                             WHEN T2.RELATION_TYPE IN (81, 82, 83) THEN\n                                 999\n                             ELSE\n                                 T2.RELATION_TYPE\n                             END RELATION_TYPE_T1\n                  FROM (SELECT T.USER_ID_A,\n                               T.SERIAL_NUMBER_A,\n                               T.USER_ID_B,\n                               T.SERIAL_NUMBER_B,\n                               T.RELATION_TYPE,\n                               T.START_DATE,\n                               T.END_DATE,\n                               T.ITEM_ID,\n                               CASE\n                                   WHEN SUBSTR(START_DATE, 1, 8) <=\n                                        1 AND\n                                        SUBSTR(END_DATE, 1, 8) >=\n                                        1 THEN\n                                       1\n                                   ELSE\n                                       0\n                                   END IS_VALID\n                        FROM (SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_PRD_CB_RELATION_UU_RT\t\t\t-- 第一张表\n                              WHERE ACCT_DATE = 20211003\n                                 OR BATCH_ID = 1\n                              UNION ALL\n                              SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_D_PRD_CB_RELATION_UU_LX\t\t-- 第二张表\n                              WHERE MONTH_ID = 1\n                                AND DAY_ID = 1) T) T1\n                           JOIN DWA_MAP_CBSS_RELATION_TYPE T2\t\t\t\t\t-- 2.1张表\n                                ON T1.RELATION_TYPE = T2.RELATION_TYPE_CBSS) T) T\n      WHERE RN = 1) A\n         JOIN (SELECT *\n               FROM (SELECT T.*,\n                            ROW_NUMBER() OVER(PARTITION BY USER_ID ORDER BY NVL(IS_INNET,0) DESC) RN\n                     FROM (SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  1 IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  1 AREA_ID_CBSS,\n                                  1 CITY_ID,\n                                  1 CITY_ID_CBSS,\n                                  T.CHANNEL_TYPE CHANNEL_ID\n                           FROM DWA_V_RT_CUS_CB_USER_INFO T\t\t\t\t-- 第4张表\n                           WHERE ACCT_DATE = 1\n                              OR (ACCT_DATE = 1 AND BATCH_ID = 1)\n                           UNION ALL\n                           SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  T.IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  T.AREA_ID_CBSS,\n                                  T.CITY_ID,\n                                  T.CITY_ID_CBSS,\n                                  T.CHANNEL_ID\n                           FROM DWA_V_D_CUS_CB_USER_INFO_LX T\t\t\t-- 第5张表\n                           WHERE MONTH_ID =\n                                 1\n                             AND DAY_ID =\n                                 1) T)\n               WHERE RN = 1) C\n              ON A.USER_ID_B = C.USER_ID\n         LEFT JOIN (SELECT MAX(IS_VALID) IS_VALID, USER_ID\n                    FROM (SELECT USER_ID,\n                                 CASE\n                                     WHEN T.START_DATE <= 1 AND\n                                          T.END_DATE >= 1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T\t\t-- 第6张表\n                          WHERE PRODUCT_MODE IN (0)\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT\t\t\t\t\t-- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n                                 CASE\n                                     WHEN REPLACE(START_DATE, 1) <=\n                                          1 AND\n                                          REPLACE(END_DATE, 1) >=\n                                          1 THEN\n                                         1\n                                     ELSE\n                                         0\n                                     END IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW\t\t\t-- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)) T\n                    GROUP BY USER_ID) E\n                   ON A.USER_ID_A = E.USER_ID"




    "CREATE \n    TABLE  \n           DWA_V_D_CUS_CB_USER_INFO_LX_LONG_PARQUET(\n                MONTH_ID  BIGINT,\n                PROV_ID  BIGINT,\n                USER_ID  BIGINT,\n                CUST_ID  BIGINT,\n                USECUST_ID  BIGINT,\n                SERVICE_TYPE  BIGINT,\n                BRAND_ID  BIGINT,\n                BRAND_ID_CBSS  BIGINT,\n                PRODUCT_ID  BIGINT,\n                PRODUCT_CLASS  BIGINT,\n                AREA_ID  BIGINT,\n                AREA_ID_CBSS  BIGINT,\n                CITY_ID  BIGINT,\n                CITY_ID_CBSS  BIGINT,\n                USER_DIFF_CODE  BIGINT,\n                USER_TYPE  BIGINT,\n                USER_TYPE_CBSS  BIGINT,\n                DEVICE_NUMBER  BIGINT,\n                NET_TYPE_CBSS  BIGINT,\n                SCORE_VALUE  BIGINT,\n                CREDIT_CLASS  BIGINT,\n                BASIC_CREDIT_VALUE  BIGINT,\n                CREDIT_VALUE  BIGINT,\n                IS_ACCT  BIGINT,\n                PAY_MODE  BIGINT,\n                PAY_MODE_CBSS  BIGINT,\n                INNET_DATE  BIGINT,\n                CREATE_DATE  BIGINT,\n                OPER_DATE  BIGINT,\n                OPEN_MODE  BIGINT,\n                OPEN_DEPART_ID  BIGINT,\n                IN_DEPART_ID  BIGINT,\n                REMOVE_FLAG  BIGINT,\n                CLOSE_DATE  BIGINT,\n                REMOVE_AREA_ID  BIGINT,\n                REMOVE_AREA_ID_CBSS  BIGINT,\n                REMOVE_CITY_ID  BIGINT,\n                REMOVE_CITY_ID_CBSS  BIGINT,\n                REMOVE_DEPART_ID  BIGINT,\n                REMOVE_REASON_CODE  BIGINT,\n                PRE_DESTROY_TIME  BIGINT,\n                FIRST_CALL_TIME  BIGINT,\n                LAST_STOP_DATE  BIGINT,\n                USER_STATUS  BIGINT,\n                USER_STATUS_CBSS  BIGINT,\n                UPDATE_TIME  BIGINT,\n                ASSURE_CUST_ID  BIGINT,\n                ASSURE_TYPE_CODE  BIGINT,\n                ASSURE_DATE  BIGINT,\n                DEVELOPER_ID  BIGINT,\n                DEVELOP_DATE  BIGINT,\n                DEVELOP_AREA_ID  BIGINT,\n                DEVELOP_AREA_ID_CBSS  BIGINT,\n                DEVELOP_CITY_ID  BIGINT,\n                DEVELOP_CITY_ID_CBSS  BIGINT,\n                CHANNEL_ID  BIGINT,\n                CHANNEL_TYPE  BIGINT,\n                CHANGEUSER_DATE  BIGINT,\n                INNET_METHOD  BIGINT,\n                ACTIVE_TYPE  BIGINT,\n                MAIN_DISCNT_CODE  BIGINT,\n                IS_INNET  BIGINT,\n                IS_CARD  BIGINT,\n                INNET_MONTHS  BIGINT,\n                STOP_MONTH  BIGINT,\n                STOP_TYPE  BIGINT,\n                IS_STAT  BIGINT,\n                IS_ADD  BIGINT,\n                ADD_TYPE  BIGINT,\n                IS_THIS_DEV  BIGINT,\n                IS_LOST  BIGINT,\n                LOST_TYPE  BIGINT,\n                IS_THIS_BREAK  BIGINT,\n                IS_CHANGE  BIGINT,\n                ACTIVITY_ID  BIGINT,\n                ACTIVITY_ID_CBSS  BIGINT,\n                ACTIVITY_TYPE  BIGINT,\n                ACTIVITY_TYPE_CBSS  BIGINT,\n                PRODUCT_ID_5G  BIGINT,\n                IS_FK_5G  BIGINT,\n                PART_ID  BIGINT,\n                DAY_ID  BIGINT\n)\nCOMMENT 'Long类型'\nSTORED AS PARQUET\nTBLPROPERTIES('parquet.compression'='none')\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWA_V_D_CUS_CB_USER_INFO_LX_LONG_PARQUET'"


    "load data local inpath '/home/hadoop/hanlei/test/DWA_V_D_CUS_CB_USER_INFO_LX.csv' into table DWA_V_D_CUS_CB_USER_INFO_LX_LONG"

      "CREATE \n    TABLE  \n           DWA_V_RT_CUS_CB_USER_INFO_LONG (\n                PROV_ID  BIGINT,\n                USER_ID  BIGINT,\n                SERVICE_TYPE  BIGINT,\n                PRODUCT_ID  BIGINT,\n                AREA_ID  BIGINT,\n                USER_TYPE  BIGINT,\n                IS_STAT  BIGINT,\n                DEVICE_NUMBER  BIGINT,\n                USER_STATUS  BIGINT,\n                CHANNEL_TYPE  BIGINT,\n                IS_INNET  BIGINT,\n                INNET_DATE  BIGINT,\n                PRODUCT_ID_5G  BIGINT,\n                IS_FK_5G  BIGINT,\n                MONTH_ID  BIGINT,\n                ACCT_DATE  BIGINT,\n                BATCH_ID  BIGINT\n)\nCOMMENT 'Long类型'\nROW FORMAT DELIMITED \nFIELDS TERMINATED BY ',' \nNULL DEFINED AS '' \nSTORED AS TEXTFILE\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWA_V_RT_CUS_CB_USER_INFO_LONG'"

    "CREATE \n    TABLE  \n           DWA_V_RT_CUS_CB_USER_INFO_LONG_PARQUET (\n                PROV_ID  BIGINT,\n                USER_ID  BIGINT,\n                SERVICE_TYPE  BIGINT,\n                PRODUCT_ID  BIGINT,\n                AREA_ID  BIGINT,\n                USER_TYPE  BIGINT,\n                IS_STAT  BIGINT,\n                DEVICE_NUMBER  BIGINT,\n                USER_STATUS  BIGINT,\n                CHANNEL_TYPE  BIGINT,\n                IS_INNET  BIGINT,\n                INNET_DATE  BIGINT,\n                PRODUCT_ID_5G  BIGINT,\n                IS_FK_5G  BIGINT,\n                MONTH_ID  BIGINT,\n                ACCT_DATE  BIGINT,\n                BATCH_ID  BIGINT\n)\nCOMMENT 'Long类型'\nSTORED AS PARQUET\nTBLPROPERTIES('parquet.compression'='none')\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWA_V_RT_CUS_CB_USER_INFO_LONG_PARQUET'"

    "CREATE \n    TABLE  \n           DWD_D_PRD_CB_RELATION_UU_LX_LONG(\n                MONTH_ID  BIGINT,\n                PROV_ID  BIGINT,\n                USER_ID_A  BIGINT,\n                SERIAL_NUMBER_A  BIGINT,\n                USER_ID_B  BIGINT,\n                SERIAL_NUMBER_B  BIGINT,\n                RELATION_TYPE  BIGINT,\n                ROLE_CODE_A  BIGINT,\n                ROLE_CODE_B  BIGINT,\n                ORDERNO  BIGINT,\n                SHORT_CODE  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                ITEM_ID  BIGINT,\n                RELATION_ATTR  BIGINT,\n                RELATION_TYPE_ZB  BIGINT,\n                PRODUCT_ID  BIGINT,\n                PRODUCT_CLASS  BIGINT,\n                PRIMARY_EPARCHY_CODE  BIGINT,\n                PRIMARY_PROVINCE_CODE  BIGINT,\n                MEM_EPARCHY_CODE  BIGINT,\n                MEM_PROVINCE_CODE  BIGINT,\n                DAY_ID  BIGINT\n)\nCOMMENT 'Long类型'\nROW FORMAT DELIMITED \nFIELDS TERMINATED BY ',' \nNULL DEFINED AS '' \nSTORED AS TEXTFILE\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWD_D_PRD_CB_RELATION_UU_LX_LONG'"

    "CREATE \n    TABLE  \n           DWD_D_PRD_CB_RELATION_UU_LX_LONG_PARQUET(\n                MONTH_ID  BIGINT,\n                PROV_ID  BIGINT,\n                USER_ID_A  BIGINT,\n                SERIAL_NUMBER_A  BIGINT,\n                USER_ID_B  BIGINT,\n                SERIAL_NUMBER_B  BIGINT,\n                RELATION_TYPE  BIGINT,\n                ROLE_CODE_A  BIGINT,\n                ROLE_CODE_B  BIGINT,\n                ORDERNO  BIGINT,\n                SHORT_CODE  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                ITEM_ID  BIGINT,\n                RELATION_ATTR  BIGINT,\n                RELATION_TYPE_ZB  BIGINT,\n                PRODUCT_ID  BIGINT,\n                PRODUCT_CLASS  BIGINT,\n                PRIMARY_EPARCHY_CODE  BIGINT,\n                PRIMARY_PROVINCE_CODE  BIGINT,\n                MEM_EPARCHY_CODE  BIGINT,\n                MEM_PROVINCE_CODE  BIGINT,\n                DAY_ID  BIGINT\n)\nCOMMENT 'Long类型'\nSTORED AS PARQUET\nTBLPROPERTIES('parquet.compression'='none')\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWD_D_PRD_CB_RELATION_UU_LX_LONG_PARQUET'"

    "CREATE \n    TABLE  \n           DWD_D_PRD_CB_USER_PRODUCT_LX_LONG(\n                MONTH_ID  BIGINT,\n                PROV_ID  BIGINT,\n                USER_ID  BIGINT,\n                PRODUCT_MODE  BIGINT,\n                PRODUCT_ID  BIGINT,\n                BRAND_ID  BIGINT,\n                BRAND_ID_CBSS  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                ITEM_ID  BIGINT,\n                USER_ID_A  BIGINT,\n                DAY_ID  BIGINT\n)\nCOMMENT 'Long类型'\nROW FORMAT DELIMITED \nFIELDS TERMINATED BY ',' \nNULL DEFINED AS '' \nSTORED AS TEXTFILE\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWD_D_PRD_CB_USER_PRODUCT_LX_LONG'"

    "CREATE \n    TABLE  \n           DWD_D_PRD_CB_USER_PRODUCT_LX_LONG_PARQUET(\n                MONTH_ID  BIGINT,\n                PROV_ID  BIGINT,\n                USER_ID  BIGINT,\n                PRODUCT_MODE  BIGINT,\n                PRODUCT_ID  BIGINT,\n                BRAND_ID  BIGINT,\n                BRAND_ID_CBSS  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                ITEM_ID  BIGINT,\n                USER_ID_A  BIGINT,\n                DAY_ID  BIGINT\n)\nCOMMENT 'Long类型'\nSTORED AS PARQUET\nTBLPROPERTIES('parquet.compression'='none')\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWD_D_PRD_CB_USER_PRODUCT_LX_LONG_PARQUET'"

    "insert into DWA_MAP_CBSS_RELATION_TYPE_LONG_PARQUET  select * from DWA_MAP_CBSS_RELATION_TYPE_LONG"

    "CREATE \n    TABLE  \n           DWD_PRD_CB_RELATION_UU_RT_LONG(\n                PROV_ID  BIGINT,\n                USER_ID_A  BIGINT,\n                SERIAL_NUMBER_A  BIGINT,\n                USER_ID_B  BIGINT,\n                SERIAL_NUMBER_B  BIGINT,\n                RELATION_TYPE  BIGINT,\n                ROLE_CODE_A  BIGINT,\n                ROLE_CODE_B  BIGINT,\n                ORDERNO  BIGINT,\n                SHORT_CODE  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                ITEM_ID  BIGINT,\n                RELATION_ATTR  BIGINT,\n                RELATION_TYPE_ZB  BIGINT,\n                PRODUCT_ID  BIGINT,\n                PRODUCT_CLASS  BIGINT,\n                PRIMARY_EPARCHY_CODE  BIGINT,\n                PRIMARY_PROVINCE_CODE  BIGINT,\n                MEM_EPARCHY_CODE  BIGINT,\n                MEM_PROVINCE_CODE  BIGINT,\n                ACCT_DATE  BIGINT,\n                BATCH_ID  BIGINT\n)\nCOMMENT 'Long类型'\nROW FORMAT DELIMITED \nFIELDS TERMINATED BY ',' \nNULL DEFINED AS '' \nSTORED AS TEXTFILE\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWD_PRD_CB_RELATION_UU_RT_LONG'"

    "CREATE \n    TABLE  \n           DWD_PRD_CB_RELATION_UU_RT_LONG_PARQUET(\n                PROV_ID  BIGINT,\n                USER_ID_A  BIGINT,\n                SERIAL_NUMBER_A  BIGINT,\n                USER_ID_B  BIGINT,\n                SERIAL_NUMBER_B  BIGINT,\n                RELATION_TYPE  BIGINT,\n                ROLE_CODE_A  BIGINT,\n                ROLE_CODE_B  BIGINT,\n                ORDERNO  BIGINT,\n                SHORT_CODE  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                ITEM_ID  BIGINT,\n                RELATION_ATTR  BIGINT,\n                RELATION_TYPE_ZB  BIGINT,\n                PRODUCT_ID  BIGINT,\n                PRODUCT_CLASS  BIGINT,\n                PRIMARY_EPARCHY_CODE  BIGINT,\n                PRIMARY_PROVINCE_CODE  BIGINT,\n                MEM_EPARCHY_CODE  BIGINT,\n                MEM_PROVINCE_CODE  BIGINT,\n                ACCT_DATE  BIGINT,\n                BATCH_ID  BIGINT\n)\nCOMMENT 'Long类型'\nSTORED AS PARQUET\nTBLPROPERTIES('parquet.compression'='none')\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/DWD_PRD_CB_RELATION_UU_RT_LONG_PARQUET'"

    "CREATE \n    TABLE  \n           TF_F_USER_PRODUCT_LONG(\n                PARTITION_ID  BIGINT,\n                USER_ID  BIGINT,\n                PRODUCT_MODE  BIGINT,\n                PRODUCT_ID  BIGINT,\n                BRAND_CODE  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                PROD_ITEM_ID  BIGINT,\n                PRIMARY_USER_ID  BIGINT,\n                END_FLAG  BIGINT,\n                KAFKA_TIME  BIGINT,\n                ACCT_DATE  BIGINT,\n                HOUR_ID  BIGINT\n)\nCOMMENT 'Long类型'\nROW FORMAT DELIMITED \nFIELDS TERMINATED BY ',' \nNULL DEFINED AS '' \nSTORED AS TEXTFILE\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/TF_F_USER_PRODUCT_LONG'"

    "CREATE \n    TABLE  \n           TF_F_USER_PRODUCT_LONG_PARQUET(\n                PARTITION_ID  BIGINT,\n                USER_ID  BIGINT,\n                PRODUCT_MODE  BIGINT,\n                PRODUCT_ID  BIGINT,\n                BRAND_CODE  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                PROD_ITEM_ID  BIGINT,\n                PRIMARY_USER_ID  BIGINT,\n                END_FLAG  BIGINT,\n                KAFKA_TIME  BIGINT,\n                ACCT_DATE  BIGINT,\n                HOUR_ID  BIGINT\n)\nCOMMENT 'Long类型'\nSTORED AS PARQUET\nTBLPROPERTIES('parquet.compression'='none')\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/TF_F_USER_PRODUCT_LONG_PARQUET'"

    "CREATE \n    TABLE  \n           TF_F_USER_PRODUCT_IU_NEW_LONG(\n                PARTITION_ID  BIGINT,\n                USER_ID  BIGINT,\n                PRODUCT_MODE  BIGINT,\n                PRODUCT_ID  BIGINT,\n                BRAND_CODE  BIGINT,\n                START_DATE  BIGINT,\n                END_DATE  BIGINT,\n                PROD_ITEM_ID  BIGINT,\n                PRIMARY_USER_ID  BIGINT,\n                END_FLAG  BIGINT,\n                KAFKA_TIME  BIGINT,\n                ACCT_DATE  BIGINT,\n                HOUR_ID  BIGINT\n)\nCOMMENT 'Long类型'\nROW FORMAT DELIMITED \nFIELDS TERMINATED BY ',' \nNULL DEFINED AS '' \nSTORED AS TEXTFILE\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/Long/TF_F_USER_PRODUCT_IU_NEW_LONG'"


              "CREATE \n    TABLE  \n           TF_F_USER_PRODUCT_IU_NEW_VARCHAR_PARQUET(\n                PARTITION_ID  VARCHAR(100),\n                USER_ID  VARCHAR(100),\n                PRODUCT_MODE  VARCHAR(100),\n                PRODUCT_ID  VARCHAR(100),\n                BRAND_CODE  VARCHAR(100),\n                START_DATE  VARCHAR(100),\n                END_DATE  VARCHAR(100),\n                PROD_ITEM_ID  VARCHAR(100),\n                PRIMARY_USER_ID  VARCHAR(100),\n                END_FLAG  VARCHAR(100),\n                KAFKA_TIME  VARCHAR(100),\n                ACCT_DATE  VARCHAR(20),\n                HOUR_ID  VARCHAR(2)\n)\nCOMMENT 'VARCHAR类型'\nSTORED AS PARQUET\nTBLPROPERTIES('parquet.compression'='none')\nLOCATION\n'/user/hive/warehouse/DongFangGuoXin/VARCHAR/TF_F_USER_PRODUCT_IU_NEW_VARCHAR_PARQUET'"

    "SELECT C.PROV_ID,\n       C.AREA_ID,\n       C.AREA_ID_CBSS,\n       C.CITY_ID,\n       C.CITY_ID_CBSS,\n       C.SERVICE_TYPE,\n       A.USER_ID_B USER_ID,\n       A.USER_ID_A COMP_ID,\n       C.DEVICE_NUMBER,\n       1 MAIN_DEVICE_NUMBER,\n       A.RELATION_TYPE COMP_TYPE,\n       A.START_DATE,\n       A.END_DATE,\n--        CASE\n--            WHEN A.RELATION_TYPE IN ('81', '82', '83') AND A.IS_VALID = '1' AND\n--                 COALESCE(E.IS_VALID, '0') = '1' THEN\n--                '1'\n--            WHEN A.RELATION_TYPE NOT IN ('81', '82', '83') AND\n--                 A.IS_VALID = '1' THEN\n--                '1'\n--            ELSE\n--                '0'\n--            END IF_USER_VALID,\n--        CASE\n--            WHEN A.RELATION_TYPE IN ('81', '82', '83') AND A.IS_VALID = '1' AND\n--                 COALESCE(E.IS_VALID, '0') = '1' THEN\n--                '1'\n--            WHEN A.RELATION_TYPE NOT IN ('81', '82', '83') AND\n--                 A.IS_VALID = '1' THEN\n--                '1'\n--            ELSE\n--                '0'\n--            END IF_COMP_VALID,\n       C.INNET_DATE,\n       1 ACCEPT_CHANNEL_COMP,\n       1 ACCEPT_MAN_COMP,\n       1 ACCEPT_CHANNEL_USER,\n       1 ACCEPT_MAN_USER,\n       C.IS_STAT,\n       C.IS_INNET,\n       C.IS_THIS_DEV,\n       1 NEW_FLAG_COMP,\n       1 NEW_FLAG_USER,\n       1 ACCEPT_DATE_COMP,\n       1 ACCEPT_DATE_USER,\n       C.CHANNEL_ID,\n       1,\n       1\nFROM (SELECT T.USER_ID_A,\n             T.SERIAL_NUMBER_A,\n             T.USER_ID_B,\n             T.SERIAL_NUMBER_B,\n             T.RELATION_TYPE_CBSS,\n             T.START_DATE,\n             T.END_DATE,\n             T.ITEM_ID,\n             T.IS_VALID,\n             T.RELATION_TYPE\n      FROM (SELECT T.USER_ID_A,\n                   T.SERIAL_NUMBER_A,\n                   T.USER_ID_B,\n                   T.SERIAL_NUMBER_B,\n                   T.RELATION_TYPE_CBSS,\n                   T.START_DATE,\n                   T.END_DATE,\n                   T.ITEM_ID,\n                   T.IS_VALID,\n                   T.RELATION_TYPE,\n                   ROW_NUMBER() OVER(PARTITION BY T.USER_ID_B, T.RELATION_TYPE_T1 ORDER BY T.IS_VALID DESC, T.START_DATE DESC, T.END_DATE DESC, T.RELATION_TYPE, T.USER_ID_A) RN\n            FROM (SELECT T1.USER_ID_A,\n                         T1.SERIAL_NUMBER_A,\n                         T1.USER_ID_B,\n                         T1.SERIAL_NUMBER_B,\n                         T1.RELATION_TYPE RELATION_TYPE_CBSS,\n                         T1.START_DATE,\n                         T1.END_DATE,\n                         T1.ITEM_ID,\n                         T1.IS_VALID,\n                         T2.RELATION_TYPE,\n--                          CASE\n--                              WHEN T2.RELATION_TYPE IN ('81', '82', '83') THEN\n--                                  '999'\n--                              ELSE\n--                                  T2.RELATION_TYPE\n--                              END\n                         1 RELATION_TYPE_T1\n                  FROM (SELECT T.USER_ID_A,\n                               T.SERIAL_NUMBER_A,\n                               T.USER_ID_B,\n                               T.SERIAL_NUMBER_B,\n                               T.RELATION_TYPE,\n                               T.START_DATE,\n                               T.END_DATE,\n                               T.ITEM_ID,\n--                                CASE\n--                                    WHEN SUBSTR(START_DATE, 1, 8) <=\n--                                         1 AND\n--                                         SUBSTR(END_DATE, 1, 8) >=\n--                                         1 THEN\n--                                        '1'\n--                                    ELSE\n--                                        '0'\n--                                    END IS_VALID\n                               1 IS_VALID\n                        FROM (SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_PRD_CB_RELATION_UU_RT            -- 第一张表\n                              WHERE ACCT_DATE = 1\n                                 OR BATCH_ID = 1\n                              UNION ALL\n                              SELECT USER_ID_A,\n                                     SERIAL_NUMBER_A,\n                                     USER_ID_B,\n                                     SERIAL_NUMBER_B,\n                                     RELATION_TYPE,\n                                     ROLE_CODE_A,\n                                     ROLE_CODE_B,\n                                     ORDERNO,\n                                     SHORT_CODE,\n                                     START_DATE,\n                                     END_DATE,\n                                     ITEM_ID,\n                                     RELATION_ATTR,\n                                     RELATION_TYPE_ZB,\n                                     PRODUCT_ID,\n                                     PRODUCT_CLASS,\n                                     PRIMARY_EPARCHY_CODE,\n                                     PRIMARY_PROVINCE_CODE,\n                                     MEM_EPARCHY_CODE,\n                                     MEM_PROVINCE_CODE\n                              FROM DWD_D_PRD_CB_RELATION_UU_LX        -- 第二张表\n                              WHERE MONTH_ID = 1\n                                AND DAY_ID = 1) T) T1\n                           JOIN DWA_MAP_CBSS_RELATION_TYPE T2                    -- 2.1张表\n                                ON T1.RELATION_TYPE = T2.RELATION_TYPE_CBSS) T) T\n      WHERE RN = 1) A\n         JOIN (SELECT *\n               FROM (SELECT T.*,\n                            ROW_NUMBER() OVER(PARTITION BY USER_ID ORDER BY NVL(IS_STAT,'0') DESC) RN\n                     FROM (SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  1 IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  1 AREA_ID_CBSS,\n                                  1 CITY_ID,\n                                  1 CITY_ID_CBSS,\n                                  T.CHANNEL_TYPE CHANNEL_ID\n                           FROM DWA_V_RT_CUS_CB_USER_INFO T                -- 第4张表\n                           WHERE ACCT_DATE = 1\n                              OR (ACCT_DATE = 1 AND BATCH_ID = 1)\n                           UNION ALL\n                           SELECT T.USER_ID,\n                                  T.PROV_ID,\n                                  T.DEVICE_NUMBER,\n                                  T.SERVICE_TYPE,\n                                  T.IS_STAT,\n                                  T.IS_INNET,\n                                  T.INNET_DATE,\n                                  T.IS_THIS_DEV,\n                                  T.AREA_ID,\n                                  T.AREA_ID_CBSS,\n                                  T.CITY_ID,\n                                  T.CITY_ID_CBSS,\n                                  T.CHANNEL_ID\n                           FROM DWA_V_D_CUS_CB_USER_INFO_LX T            -- 第5张表\n                           WHERE MONTH_ID =\n                                 1\n                             AND DAY_ID =\n                                 1) T)\n               WHERE RN = 1) C\n              ON A.USER_ID_B = C.USER_ID\n         LEFT JOIN (SELECT MAX(IS_VALID) IS_VALID, USER_ID\n                    FROM (SELECT USER_ID,\n--                                  CASE\n--                                      WHEN T.START_DATE <= 1 AND\n--                                           T.END_DATE >= 1 THEN\n--                                          1\n--                                      ELSE\n--                                          0\n--                                      END IS_VALID\n                                 1 IS_VALID\n                          FROM DWD_D_PRD_CB_USER_PRODUCT_LX T        -- 第6张表\n                          WHERE PRODUCT_MODE IN (1)\n                            AND MONTH_ID = 1\n                            AND DAY_ID = 1\n                            AND BRAND_ID_CBSS IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n--                                  CASE\n--                                      WHEN REPLACE(START_DATE, 1) <=\n--                                           1 AND\n--                                           REPLACE(END_DATE, 1) >=\n--                                           1 THEN\n--                                          1\n--                                      ELSE\n--                                          0\n--                                      END IS_VALID\n                                 1 IS_VALID\n                          FROM TF_F_USER_PRODUCT                    -- 第7张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID <= 1))\n                            AND BRAND_CODE IN (1, 1)\n                          UNION ALL\n                          SELECT USER_ID,\n--                                  CASE\n--                                      WHEN REPLACE(START_DATE, 1) <=\n--                                           1 AND\n--                                           REPLACE(END_DATE, 1) >=\n--                                           1 THEN\n--                                          1\n--                                      ELSE\n--                                          0\n--                                      END IS_VALID\n                                 1 IS_VALID\n                          FROM TF_F_USER_PRODUCT_IU_NEW            -- 第8张表\n                          WHERE (ACCT_DATE =\n                                 1 OR\n                                 (ACCT_DATE = 1 AND HOUR_ID = 1))\n                            AND BRAND_CODE IN (1, 1)) T\n                    GROUP BY USER_ID) E\n                   ON A.USER_ID_A = E.USER_ID"


  }

}
